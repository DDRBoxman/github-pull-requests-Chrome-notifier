<html>
<head>
<LINK REL=StyleSheet HREF="style.css" TYPE="text/css">
<script type="text/javascript" src="jquery-1.7.min.js"></script> 
<script type="text/javascript" src="base64.js"></script> 
<script src="oauth2/oauth2.js"></script>
<script src="persistence.js" type="application/javascript"></script>
<script src="persistence.store.sql.js" type="application/javascript"></script>
<script src="persistence.store.websql.js" type="application/javascript"></script>
<script type="text/javascript" src="common.js"></script>
<script type="text/javascript" src="common-db.js"></script>
<script>
	$(document).ready(function() {
		
		var provider = window['github'];
		
		if (provider.get('accessToken')) {
			$("#pullRequestsDiv").show();
			showPullRequests();
		}
		else {
				$("#pullRequestsDiv").hide();
				var myid = chrome.i18n.getMessage("@@extension_id");
				chrome.tabs.create({'url': 'chrome-extension://' + myid + '/options.html'}, function(tab) {});
				window.close();
			
		}
	});

	function showPullRequests() {

		var allPulls = PullRequest.all().order("number", true);

		allPulls.list(null, function (results) {

			html = "";
		    results.forEach(function (r) {
				html += "<a href='" + r.html_url + "'>" + r.title + "</a></br>";
		    });
			$('#pullRequestsDiv').html(html);

		});
		
	}

</script>
</head>
<body>
	<div id="pullRequestsDiv">

	</div>
</body>
</html>
